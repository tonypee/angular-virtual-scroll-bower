/* angular-virtual-scroll - v0.5.0 - 2013-12-12 */ (function(){"use strict";angular.module("sf.virtualScroll",[])})(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.filter("sublist",function(){return function(t,e,r){return t.slice(r,r+e)}})}(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.directive("sfScroller",function(){function t(t){var e=t.match(/^(x|y)\s*(=|in)\s*(.+) to (.+)$/);if(!e)throw Error("Expected sfScroller in form of '_axis_ in _lower_ to _upper_' but got '"+t+"'.");return{axis:e[1],lower:e[3],upper:e[4]}}var e=18;return function(r,i,o){var n=t(o.sfScroller),l=r.$eval(n.lower),a=r.$eval(n.upper),s="x"===n.axis;i.css({height:s?"1em":"100%",width:s?"100%":"1em","overflow-x":s?"scroll":"hidden","overflow-y":s?"hidden":"scroll",position:"absolute",top:s?"100%":0,right:0}).parent().css({position:"relative"});var c=angular.element("<div></div>");i.append(c),i.bind("scroll",function(){var t=i.prop("scrollTop");o.ngModel&&r.$apply(o.ngModel+" = "+t/e)}),r.$watch(n.lower,function(t){l=t,c.css("height",(a-l)*e+"px")}),r.$watch(n.upper,function(t){a=t,c.css("height",(a-l)*e+"px")}),r.$watch(o.ngModel,function(t){var r=t*e;i.prop("scrollTop")!==r&&i.prop("scrollTop".scrollTop)})}})}(),function(){"use strict";function t(e,r,i){return angular.isArray(e)?angular.forEach(e,function(e){return t(e,r,i)}):Math.max(r,Math.min(e,i))}var e=angular.module("sf.virtualScroll"),r=["TABLE","TBODY","THEAD","TR","TFOOT"],i=["TABLE","TBODY","THEAD","TR","TFOOT"],o=["TABLE","TBODY","THEAD","TR","TFOOT"];e.directive("sfVirtualRepeat",["$log","$rootElement",function(e,n){function l(t){var e=t.match(/^\s*([\$\w]+)\s+in\s+([\S\s]*)$/);if(!e)throw Error("Expected sfVirtualRepeat in form of '_item_ in _collection_' but got '"+t+"'.");return{value:e[1],collection:e[2]}}function a(t,e){var r,i=t.tagName.toUpperCase();for(r=0;e.length>r;r++)if(e[r]===i)return!0;return!1}function s(t){var e,o,l=n[0];for(e=t.parent().parent()[0];e!==l&&1==e.nodeType;e=e.parentNode)if(!a(e,r)&&1==e.childElementCount&&!a(e.firstElementChild,i)){for(o=e.firstChild;o&&(3!=o.nodeType||!/\S/g.test(o.textContent));o=o.nextSibling);if(null==o)return{viewport:angular.element(e),content:angular.element(e.firstElementChild)}}throw Error("No suitable viewport element")}function c(t){var e={overflow:"auto"},r=window.getComputedStyle?window.getComputedStyle(t[0]):t[0].currentStyle,i=r&&r.getPropertyValue("max-height"),o=r&&r.getPropertyValue("height");i&&"0px"!==i?e.maxHeight=i:e.height=o&&"0px"!==o?o:window.innerHeight,t.css(e)}function u(t){var e={margin:0,padding:0,border:0,"box-sizing":"border-box"};t.css(e)}function f(t){var r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,i=r&&r.getPropertyValue("max-height"),o=r&&r.getPropertyValue("height");if(o&&"0px"!==o&&"auto"!==o)e.debug('Row height is "%s" from css height',o);else if(i&&"0px"!==i&&"none"!==i)o=i,e.debug('Row height is "%s" from css max-height',o);else{if(!t.clientHeight)throw Error("Unable to compute height of row");o=t.clientHeight+"px",e.debug('Row height is "%s" from client height',o)}return angular.element(t).css("height",o),parseInt(o,10)}function g(r,i,n){function g(r,i,l){function g(t){var e={margin:"0"};a(t[0],o)||(e.display="block"),$&&(e.height=$+"px"),t.css(e)}function p(t,e,r){var i=r.$new(),o=r.$eval(e);return i[h.value]=o[t],i.$index=t,i.$first=0===t,i.$last=t===o.length-1,i.$middle=!(i.$first||i.$last),i.$watch(function(){o=r.$eval(e),i[h.value]=o[t]}),i}function v(t,e,r,i,o){var l,a,s,c=document.createDocumentFragment(),u=[];for(a=t;a!==e;a++)s=p(a,r,i),l=n(s,angular.noop),g(l),u.push(l),c.appendChild(l[0]);return o.after(c),u}function d(){var e=t(S.firstActive,S.firstVisible-S.lowWater,S.firstVisible-S.highWater),r=t(S.firstActive+S.active,S.firstVisible+S.visible+S.lowWater,S.firstVisible+S.visible+S.highWater);S.firstActive=t(e,0,S.total-S.visible-S.lowWater),S.active=Math.min(r,S.total)-S.firstActive}function m(t){$&&r.$apply(function(){S.firstVisible=Math.floor(t.target.scrollTop/$),S.visible=Math.ceil(E.viewport[0].clientHeight/$),e.log("scroll to row %o",S.firstVisible),y=t.target.scrollTop+t.target.clientHeight>=t.target.scrollHeight,d(),e.log(" state is now %o",S),e.log(" sticky = %o",y)})}function w(t){var e=t.$eval(h.collection);return e.length!==S.total&&(S.total=e.length,d()),{start:S.firstActive,active:S.active,len:e.length}}function b(t,e){var r,i,o=Array.prototype[t];for(i=0;e>i;i++)r=o.call(T),r.scope().$destroy(),r.remove()}function x(t,r,o){var n,l=r.start+r.active;if(t===r)e.debug("initial listen"),n=v(t.start,l,h.collection,o,i),T=n,T.length&&($=f(n[0][0]));else{var a=t.start+t.active,s=t.start>=r.start,c=s?t.start-r.start:r.start-t.start,u=a>=l?a-l:l-a,g=(s?r.active:t.active)>c;if(e.debug("change by %o,%o rows %s",c,u,s?"forward":"backward"),g){if(s?(e.debug("need to remove from the top"),b("shift",c)):c&&(e.debug("need to add at the top"),n=v(t.start,r.start,h.collection,o,i),T=n.concat(T)),l>a)e.debug("need to remove from the bottom"),b("pop",l-a);else if(u){var p=T[T.length-1];e.debug("need to add to the bottom"),n=v(l,a,h.collection,o,p),T=T.concat(n)}}else e.debug("non-contiguous change"),b("pop",T.length),T=v(t.start,a,h.collection,o,i);!$&&T.length&&($=f(T[0][0])),E.content.css({"padding-top":t.start*$+"px"})}E.content.css({height:t.len*$+"px"}),y&&(E.viewport[0].scrollTop=E.viewport[0].clientHeight+E.viewport[0].scrollHeight)}var T=[],$=0,y=!1,E=s(i),S="ngModel"in l?r.$eval(l.ngModel):{};S.firstActive=0,S.firstVisible=0,S.visible=0,S.active=0,S.total=0,S.lowWater=S.lowWater||100,S.highWater=S.highWater||300,u(E.content),c(E.viewport),E.viewport.bind("scroll",m),r.$watch(w,x,!0)}var h=l(i.sfVirtualRepeat);return{post:g}}return{require:"?ngModel",transclude:"element",priority:1e3,terminal:!0,compile:g}}])}();